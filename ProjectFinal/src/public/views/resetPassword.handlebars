<link rel="stylesheet" href="../css/createAccount.css">

<div class="container mt-3 pt-5" style="max-width: 40%;">

  <div class="row text-center p-4" style="background-color: #e1e1e1;">

    <form class="col-12 form-login" role="form" id="recoverPasswordForm">
      <div class="row justify-content-center text-center">
        <div class="col-10 reg-icon">
          <span class="fa-2x"><h1><icon class="bi bi-person"></icon></h1>Recuperar Contraseña</span>
        </div>
      </div>

      <div class="row justify-content-center">
        <p>Para reiniciar tu contraseña, completa el formulario de abajo.</p>
        <div class="col-10">
          <input type="text" class="form-control" id="token" name="token" placeholder="El token del mail" required>
        </div>
        <div class="col-10">
          <input type="email" class="form-control" id="email" name="email" placeholder="Tu correo electrónico" required>
        </div>
        <div class="col-10">
          <input type="password" class="form-control" id="password" name="password" placeholder="Nueva contraseña" required>
        </div>
        <div class="col-10">
          <input type="password" class="form-control" id="password-repeat" name="password-repeat" placeholder="Repetir nueva contraseña" required>
        </div>
      </div>

      <div class="row justify-content-center pt-4">
        <div class="col">
          <button type="submit" class="btn btn-info" id="recoverPassword">
            <span class="glyphicon glyphicon-share-alt"></span>
            Reiniciar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  
  function spinner(elementName, isButton) {

    const button = document.getElementById(elementName);
    if (isButton) {
      button.setAttribute('disabled', '');
    }
    button.classList.add('disabled');

    // Create the loader div
    var loaderDiv = document.createElement('div');
    loaderDiv.className = 'loader';
    loaderDiv.style.display = 'block';

    // Create the loading div
    var loadingDiv = document.createElement('div');
    loadingDiv.className = 'loading';

    // Append the loading div to the loader div
    loaderDiv.appendChild(loadingDiv);

    // Append the loader div to the button
    button.innerText =  'Reiniciando...';
    button.appendChild(loaderDiv);
  }

  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('recoverPasswordForm');
    form.addEventListener('submit', function (event) {
      event.preventDefault();

      if (document.getElementById('password').value !== document.getElementById('password-repeat').value){
        alert('Las contraseñas no coinciden')
        return 
      }

      spinner('recoverPassword', true)

      fetch('/users/resetPassword', {
        method: 'POST',
        headers: {'Content-type' : 'application/json; charset=UTF-8'},
        body: JSON.stringify({ 
            token: document.getElementById('token').value,
            email: document.getElementById('email').value,
            password: document.getElementById('password').value
          })
      })
      .then(response => response.json())
      .then(data => {
        spinner('recoverPassword', true)
        alert(data.message); // Alert message
        window.location.replace('/')
      })
      .catch(error => {
        spinner('recoverPassword', true)
        console.error('Error:', error);
      });
    });
  });
  
</script>